(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const G=e=>{e.remove()},Q=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),F=(e,t,{onPreviewPicture:o,onLikeIcon:s,onDeleteCard:r})=>{const n=Q(),a=n.querySelector(".card__like-button"),g=n.querySelector(".card__like-count"),u=n.querySelector(".card__control-button_type_delete"),l=n.querySelector(".card__image");return l.src=e.link,l.alt=e.name,n.querySelector(".card__title").textContent=e.name,g.textContent=e.likes.length,e.likes.some(Z=>Z._id===t)&&a.classList.add("card__like-button_is-active"),t!==e.owner._id?u.remove():r&&u.addEventListener("click",()=>r(n,e._id)),s&&a.addEventListener("click",()=>s(n,e._id)),o&&l.addEventListener("click",()=>o({name:e.name,link:e.link})),n},N=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}},y=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",N)},d=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",N)},X=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{d(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&d(e)})},Y=(e,t,o,s)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(s.inputErrorClass),r.textContent=o,r.classList.add(s.errorClass)},O=(e,t,o)=>{const s=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),s.textContent="",s.classList.remove(o.errorClass)},ee=(e,t,o)=>{const s=t.value.trim();if(t.setCustomValidity(""),t.required&&s.length===0&&t.setCustomValidity("Заполните это поле."),t.dataset.errorMessage&&s.length>0&&(/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(s)||t.setCustomValidity(t.dataset.errorMessage)),t.validity.valid)return O(e,t,o),!0;{const r=t.validationMessage;return Y(e,t,r,o),!1}},te=e=>e.some(t=>!t.validity.valid),V=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},oe=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},B=(e,t,o)=>{te(e)?V(t,o):oe(t,o)},re=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),s=e.querySelector(t.submitButtonSelector);B(o,s,t),o.forEach(r=>{r.addEventListener("input",()=>{ee(e,r,t),B(o,s,t)})})},v=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),s=e.querySelector(t.submitButtonSelector);o.forEach(r=>{r.setCustomValidity(""),O(e,r,t)}),V(s,t)},ne=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{re(o,e)})},c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"52c53acc-ee6c-4a85-b67f-14afcce5cebe","Content-Type":"application/json"}},m=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),se=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(m),W=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(m),ce=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(m),ae=({avatar:e})=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(m),le=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(m),ie=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(m),ue=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(m),j=document.querySelector(".places__list"),E=document.querySelector(".popup_type_edit"),L=E.querySelector(".popup__form"),R=L.querySelector(".popup__input_type_name"),z=L.querySelector(".popup__input_type_description"),x=document.querySelector(".popup_type_new-card"),p=x.querySelector(".popup__form"),de=p.querySelector(".popup__input_type_card-name"),pe=p.querySelector(".popup__input_type_url"),I=document.querySelector(".popup_type_image"),T=I.querySelector(".popup__image"),me=I.querySelector(".popup__caption"),_e=document.querySelector(".profile__edit-button"),fe=document.querySelector(".profile__add-button"),w=document.querySelector(".profile__title"),M=document.querySelector(".profile__description"),U=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_edit-avatar"),f=P.querySelector(".popup__form"),ye=f.querySelector(".popup__input"),A=document.querySelector(".popup_type_remove-card"),he=A.querySelector(".popup__form"),b=document.querySelector(".popup_type_info"),Se=b.querySelector(".popup__title"),_=b.querySelector(".popup__info"),ve=b.querySelector(".popup__text"),D=b.querySelector(".popup__list"),be=document.querySelector(".logo"),Ce=document.querySelector("#popup-info-definition-template").content,qe=document.querySelector("#popup-info-user-preview-template").content;let k,C=null,q=null;const J=({name:e,link:t})=>{T.src=t,T.alt=e,me.textContent=e,y(I)},i=(e,t,o="Сохранить",s="Сохранение...")=>{e?t.textContent=s:t.textContent=o},Le=e=>{e.preventDefault(),i(!0,e.submitter),ce({name:R.value.trim(),about:z.value.trim()}).then(t=>{w.textContent=t.name,M.textContent=t.about,d(E)}).catch(t=>{console.error(t)}).finally(()=>{i(!1,e.submitter)})},ge=e=>{e.preventDefault(),i(!0,e.submitter),ae({avatar:ye.value.trim()}).then(t=>{U.style.backgroundImage=`url(${t.avatar})`,f.reset(),v(f,h),d(P)}).catch(t=>{console.error(t)}).finally(()=>{i(!1,e.submitter)})},H=(e,t)=>{C=e,q=t,y(A)};he.addEventListener("submit",e=>{e.preventDefault(),!(!C||!q)&&(i(!0,e.submitter,"Да","Удаление..."),ie(q).then(()=>{G(C),d(A),C=null,q=null}).catch(t=>{console.error(t)}).finally(()=>{i(!1,e.submitter,"Да")}))});const K=(e,t)=>{const o=e.querySelector(".card__like-button"),s=e.querySelector(".card__like-count"),r=o.classList.contains("card__like-button_is-active");ue(t,r).then(n=>{o.classList.toggle("card__like-button_is-active"),s.textContent=n.likes.length}).catch(n=>{console.error(n)})},ke=e=>{e.preventDefault(),i(!0,e.submitter,"Создать","Создание..."),le({name:de.value.trim(),link:pe.value.trim()}).then(t=>{j.prepend(F(t,k,{onPreviewPicture:J,onLikeIcon:K,onDeleteCard:H})),p.reset(),v(p,h),d(x)}).catch(t=>{console.error(t)}).finally(()=>{i(!1,e.submitter,"Создать")})},h={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},$=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),S=(e,t)=>{const o=Ce.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},Ee=e=>{const t=qe.querySelector(".popup__list-item").cloneNode(!0);return t.textContent=e,t},xe=()=>{W().then(e=>{_.replaceChildren(),D.replaceChildren(),Se.textContent="Статистика пользователей",ve.textContent="Все пользователи:";const t=e.length,o=e.length>0?$(new Date(e[e.length-1].createdAt)):"-",s=e.length>0?$(new Date(e[0].createdAt)):"-",r={},n=new Map;e.forEach(u=>{const l=u.owner._id;r[l]=(r[l]||0)+1,n.has(l)||n.set(l,u.owner.name)});const a=n.size,g=Math.max(0,...Object.values(r));_.append(S("Всего карточек:",t)),_.append(S("Первая создана:",o)),_.append(S("Последняя создана:",s)),_.append(S("Всего пользователей:",a)),_.append(S("Максимум карточек от одного:",g)),n.forEach(u=>{D.append(Ee(u))}),y(b)}).catch(e=>{console.error(e)})};ne(h);be.addEventListener("click",xe);L.addEventListener("submit",Le);p.addEventListener("submit",ke);f.addEventListener("submit",ge);_e.addEventListener("click",()=>{R.value=w.textContent,z.value=M.textContent,v(L,h),y(E)});U.addEventListener("click",()=>{f.reset(),v(f,h),y(P)});fe.addEventListener("click",()=>{p.reset(),v(p,h),y(x)});const Ie=document.querySelectorAll(".popup");Ie.forEach(e=>{X(e)});Promise.all([W(),se()]).then(([e,t])=>{w.textContent=t.name,M.textContent=t.about,U.style.backgroundImage=`url(${t.avatar})`,k=t._id,e.forEach(o=>{j.append(F(o,k,{onPreviewPicture:J,onLikeIcon:K,onDeleteCard:H}))})}).catch(e=>{console.error(e)});
