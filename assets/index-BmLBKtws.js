(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const Z=e=>{e.remove()},G=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),N=(e,t,{onPreviewPicture:o,onLikeIcon:n,onDeleteCard:r})=>{const s=G(),u=s.querySelector(".card__like-button"),T=s.querySelector(".card__like-count"),a=s.querySelector(".card__control-button_type_delete"),l=s.querySelector(".card__image");return l.src=e.link,l.alt=e.name,s.querySelector(".card__title").textContent=e.name,T.textContent=e.likes.length,e.likes.some(h=>h._id===t)&&u.classList.add("card__like-button_is-active"),t!==e.owner._id?a.remove():r&&a.addEventListener("click",()=>r(s,e._id)),n&&u.addEventListener("click",()=>n(s,e._id)),o&&l.addEventListener("click",()=>o({name:e.name,link:e.link})),s},O=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}},f=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",O)},d=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",O)},Q=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{d(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&d(e)})},X=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},D=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)},Y=(e,t,o)=>{const n=t.value.trim();if(t.setCustomValidity(""),t.required&&n.length===0&&t.setCustomValidity("Заполните это поле."),t.dataset.errorMessage&&n.length>0&&(/^[a-zA-Zа-яА-ЯёЁ\s-]+$/.test(n)||t.setCustomValidity(t.dataset.errorMessage)),t.validity.valid)return D(e,t,o),!0;{const r=t.validationMessage;return X(e,t,r,o),!1}},ee=e=>e.some(t=>!t.validity.valid),V=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},te=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},A=(e,t,o)=>{ee(e)?V(t,o):te(t,o)},oe=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);A(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{Y(e,r,t),A(o,n,t)})})},v=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{r.setCustomValidity(""),D(e,r,t)}),V(n,t)},re=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{oe(o,e)})},c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"52c53acc-ee6c-4a85-b67f-14afcce5cebe","Content-Type":"application/json"}},m=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),ne=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(m),W=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(m),se=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(m),ce=({avatar:e})=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(m),ae=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(m),le=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(m),ie=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(m),j=document.querySelector(".places__list"),E=document.querySelector(".popup_type_edit"),g=E.querySelector(".popup__form"),z=g.querySelector(".popup__input_type_name"),J=g.querySelector(".popup__input_type_description"),x=document.querySelector(".popup_type_new-card"),p=x.querySelector(".popup__form"),ue=p.querySelector(".popup__input_type_card-name"),de=p.querySelector(".popup__input_type_url"),I=document.querySelector(".popup_type_image"),$=I.querySelector(".popup__image"),pe=I.querySelector(".popup__caption"),me=document.querySelector(".profile__edit-button"),_e=document.querySelector(".profile__add-button"),w=document.querySelector(".profile__title"),M=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),B=document.querySelector(".popup_type_edit-avatar"),_=B.querySelector(".popup__form"),fe=_.querySelector(".popup__input"),U=document.querySelector(".popup_type_remove-card"),ye=U.querySelector(".popup__form"),C=document.querySelector(".popup_type_info"),he=C.querySelector(".popup__title"),S=C.querySelector(".popup__info"),Se=C.querySelector(".popup__text"),F=C.querySelector(".popup__list"),ve=document.querySelector(".logo"),Ce=document.querySelector("#popup-info-definition-template").content,be=document.querySelector("#popup-info-user-preview-template").content;let k,q=null,L=null;const R=({name:e,link:t})=>{$.src=t,$.alt=e,pe.textContent=e,f(I)},i=(e,t,o="Сохранить",n="Сохранение...")=>{e?t.textContent=n:t.textContent=o},qe=e=>{e.preventDefault(),i(!0,e.submitter),se({name:z.value.trim(),about:J.value.trim()}).then(t=>{w.textContent=t.name,M.textContent=t.about,d(E)}).catch(t=>{console.error(t)}).finally(()=>{i(!1,e.submitter)})},Le=e=>{e.preventDefault(),i(!0,e.submitter),ce({avatar:fe.value.trim()}).then(t=>{P.style.backgroundImage=`url(${t.avatar})`,_.reset(),v(_,y),d(B)}).catch(t=>{console.error(t)}).finally(()=>{i(!1,e.submitter)})},H=(e,t)=>{q=e,L=t,f(U)};ye.addEventListener("submit",e=>{e.preventDefault(),!(!q||!L)&&(i(!0,e.submitter,"Да","Удаление..."),le(L).then(()=>{Z(q),d(U),q=null,L=null}).catch(t=>{console.error(t)}).finally(()=>{i(!1,e.submitter,"Да")}))});const K=(e,t)=>{const o=e.querySelector(".card__like-button"),n=e.querySelector(".card__like-count"),r=o.classList.contains("card__like-button_is-active");ie(t,r).then(s=>{o.classList.toggle("card__like-button_is-active"),n.textContent=s.likes.length}).catch(s=>{console.error(s)})},ge=e=>{e.preventDefault(),i(!0,e.submitter,"Создать","Создание..."),ae({name:ue.value.trim(),link:de.value.trim()}).then(t=>{j.prepend(N(t,k,{onPreviewPicture:R,onLikeIcon:K,onDeleteCard:H})),p.reset(),v(p,y),d(x)}).catch(t=>{console.error(t)}).finally(()=>{i(!1,e.submitter,"Создать")})},y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},b=(e,t)=>{const o=Ce.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},ke=e=>{const t=be.querySelector(".popup__list-item").cloneNode(!0);return t.textContent=e,t},Ee=()=>{W().then(e=>{S.replaceChildren(),F.replaceChildren(),he.textContent="Статистика карточек",Se.textContent="Популярные карточки:";const t=new Map;let o=0,n=0,r="-";e.forEach(a=>{const l=a.owner._id;t.has(l)||t.set(l,a.owner.name);const h=a.likes.length;o+=h,h>n&&(n=h,r=a.owner.name)});const s=t.size;S.append(b("Всего пользователей:",s)),S.append(b("Всего лайков:",o)),S.append(b("Максимально лайков от одного:",n)),S.append(b("Чемпион лайков:",r)),[...e].sort((a,l)=>l.likes.length-a.likes.length).slice(0,3).forEach(a=>{F.append(ke(a.name))}),f(C)}).catch(e=>{console.error(e)})};re(y);ve.addEventListener("click",Ee);g.addEventListener("submit",qe);p.addEventListener("submit",ge);_.addEventListener("submit",Le);me.addEventListener("click",()=>{z.value=w.textContent,J.value=M.textContent,v(g,y),f(E)});P.addEventListener("click",()=>{_.reset(),v(_,y),f(B)});_e.addEventListener("click",()=>{p.reset(),v(p,y),f(x)});const xe=document.querySelectorAll(".popup");xe.forEach(e=>{Q(e)});Promise.all([W(),ne()]).then(([e,t])=>{w.textContent=t.name,M.textContent=t.about,P.style.backgroundImage=`url(${t.avatar})`,k=t._id,e.forEach(o=>{j.append(N(o,k,{onPreviewPicture:R,onLikeIcon:K,onDeleteCard:H}))})}).catch(e=>{console.error(e)});
